{% extends 'base.html' %}

{% block title %}Quiz Ergebnis - Lernmanager{% endblock %}

{% block content %}
<div class="text-center mb-2">
    {% if bestanden %}
    <h1>ğŸ‰ Bestanden!</h1>
    <p class="text-success" style="font-size: 1.5rem;">Du hast {{ punkte }} von {{ max_punkte }} Punkten erreicht.</p>
    {% else %}
    <h1>ğŸ’ª Fast geschafft!</h1>
    <p style="font-size: 1.5rem;">Du hast {{ punkte }} von {{ max_punkte }} Punkten erreicht.</p>
    {% set prozent = ((punkte / max_punkte) * 100)|int %}
    <p>Du brauchst mindestens 70% ({{ (max_punkte * 0.7)|round(0, 'ceil')|int }} Punkte) zum Bestehen.</p>

    {% if previous_attempt %}
        {% set previous_prozent = ((previous_attempt.punkte / previous_attempt.max_punkte) * 100)|int %}
        {% if prozent > previous_prozent %}
        <div class="alert alert-success" style="margin-top: 1rem;">
            â­ Du wirst besser! Beim letzten Mal: {{ previous_attempt.punkte }}/{{ previous_attempt.max_punkte }} ({{ previous_prozent }}%).
            Jetzt: {{ punkte }}/{{ max_punkte }} ({{ prozent }}%). Weiter so! ğŸ’ª
        </div>
        {% elif prozent == previous_prozent %}
        <div class="alert alert-info" style="margin-top: 1rem;">
            Du hast die gleiche Punktzahl wie beim letzten Mal. Schau dir die Antworten unten an und versuche es noch einmal!
        </div>
        {% endif %}
    {% else %}
        <p style="margin-top: 1rem;">Schau dir die richtigen Antworten unten an und versuche es noch einmal! Du schaffst das! ğŸš€</p>
    {% endif %}
    {% endif %}
</div>

<div class="card mb-2">
    <div class="card-header">ğŸ“Š Deine Antworten</div>
    {% for question in quiz.questions %}
    <div class="quiz-question">
        <h4>Frage {{ loop.index }}: {{ question.question }}</h4>
        {% set q_idx = loop.index0|string %}
        {% set user_answers = antworten.get(q_idx, []) %}
        {% for answer in question.answers %}
        {% set was_selected = loop.index0 in user_answers %}
        <div class="quiz-option {% if was_selected %}selected{% endif %}">
            {% if was_selected %}â—{% else %}â—‹{% endif %}
            <span>{{ answer }}</span>
        </div>
        {% endfor %}
    </div>
    {% endfor %}
</div>

<div class="flex gap-1">
    {% if not bestanden %}
    <a href="{{ url_for('student_quiz', student_task_id=task.id) }}" class="btn btn-primary">ğŸ”„ Erneut versuchen</a>
    {% endif %}
    <a href="{{ url_for('student_dashboard') }}" class="btn btn-secondary">â† ZurÃ¼ck</a>
</div>
{% endblock %}
